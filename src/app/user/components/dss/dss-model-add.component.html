<div class="app-main__inner">
  <div class="app-page-title">
    <div class="page-title-wrapper">
      <div class="page-title-heading">
        <div class="page-title-icon">
          <i class="pe-7s-note icon-gradient bg-mean-fruit">
          </i>
        </div>
        <div>{{ 'DSS_model_selection.Title' | translate }}</div>
      </div>
    </div>
  </div>
  <div class="container mx-auto my-5 page-box">
    <fieldset class="border p-2">
      <legend class="w-auto px-1 text-muted h3">
        <strong class="bold-600">
          {{ farm.name }}
        </strong>
      </legend>
      <form [formGroup]="selCropForm">
        <div class="row">
          <div class="col-md-6 col-xs-12">
            <fieldset class="border p-3 m-2">
              <legend class="w-auto px-1 text-muted h5">
                <b>{{ 'DSS_model_selection.Crops_selection' | translate }}</b>
              </legend>

              <div formGroupName="cropSelection">
                <div class="form-group row">
                  <div class="col-sm-11">
                    <select multiple class="form-control" id="crops" formControlName="cropEppoCode">
                      <ng-template ngFor let-crop [ngForOf]="cropsEppoCodes">
                        <!--<option value="{{crop.code}}">{{ crop.code | eppoCode }}</option>-->
                        <option value="{{crop.code}}">{{ crop.text }}</option>
                      </ng-template>
                    </select>
                    <small class="hideForMobile col-2 pull-left mt-2" [innerHtml]="( 'DSS_model_selection.Multiselect_tip' | translate )"></small>
                  </div>
                </div>
              </div>
            </fieldset>
          </div>
          <div class="col-md-6 col-xs-12">
            <fieldset class="border p-3 m-2">
              <legend class="w-auto px-1 text-muted h5">
                <b>{{ 'DSS_model_selection.Filters' | translate }}</b>
              </legend>
              <div>
                <input class= "mr-2" type="checkbox" [checked]="countryFilterActive" (change)="onCheckboxChange()" />
                <label class="countryFilterLabel col-form-label p-1" for="countries">
                  {{ 'DSS_model_selection.Enable_country_filter' | translate }}
                  <a class="details" (click)="openModal(countryFilterInfoModal,'modal-sm')">
                    <i class="fas fa-info-circle light-blue-icon ml-1 icon-toggle"></i>
                  </a>
                </label>
                <select class="form-control" id="countries" (change)="countryFilterChange($event)" [disabled]="!countryFilterActive">
                  <option hidden disabled selected value></option>
                  <ng-template ngFor let-c [ngForOf]="countries">
                    <option value="{{c.code}}">{{ c.name }}</option>
                  </ng-template>
                </select>
              </div>
            </fieldset>
            <button class="btn btn-info btn-sm pull-right m-4" (click)="onConfirmSelectedCrops()"
                      [disabled]="!selCropForm.get('cropSelection').get('cropEppoCode').valid">
                      {{ 'DSS_model_selection.Show_DSS' | translate }}
            </button>
          </div>
        </div>
        <div class="row">
          <div *ngIf="areCropsSelected" class="col-12 mt-4">
            <fieldset class="border p-3 ml-3 mr-3 mb-3">
              <legend class="w-auto px-1 text-muted h5">
                <b>{{ 'DSS_model_selection.DSS_models_selection' | translate }}</b>
              </legend>
              <div class="row">
                <div class="col">
                  <table class="table table-striped table-responsive-sm table-bordered">
                    <thead>
                      <tr>
                        <th class="text-center col-3">{{ 'DSS_model_selection.Crop_name' | translate }}</th>
                        <th class="text-center col-3">{{ 'DSS_model_selection.Pest_name' | translate }}</th>
                        <th class="text-center col-3">{{ 'DSS_model_selection.Model_name' | translate }}</th>
                        <th class="text-center col-3">{{ 'DSS_model_selection.DSS_name' | translate }}</th>
                        <th class="text-center"></th>
                      </tr>
                    </thead>
                    <tbody>
                      <ng-container *ngFor="let dssSel of data">
                        <tr app-dss-model-row *ngFor="let model of dssSel.models; index as i" [model]="model"
                          [selectedCrops]="selCropForm.get('cropSelection').get('cropEppoCode').value"
                          [dssSelection]="dssSel" (select)="onSelectDSS($event)" (deselect)="onDeselectDSS($event)">
                        </tr>
                      </ng-container>
                    </tbody>
                  </table>
                </div>
                <!--<accordion class="col" [isAnimated]="true">
                  <accordion-group *ngFor="let dssSel of data">
                    <span accordion-heading tooltip="Click to show">
                      {{dssSel.name}}
                      <i class="fas fa-bars" style="position:absolute; top: 20px; right: 2%;"></i>
                    </span>
                    <div class="col">
                      <table class="table table-striped table-bordered">
                        <thead>
                          <tr>
                            <th class="text-center col-3">{{ 'DSS_model_selection.Crop_name' | translate }}</th>
                            <th class="text-center col-3">{{ 'DSS_model_selection.Pest_name' | translate }}</th>
                            <th class="text-center">{{ 'DSS_model_selection.DSS_name' | translate }}</th>
                            <th class="text-center"></th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr app-dss-model-row *ngFor="let model of dssSel.models; index as i" [model]="model"
                            [selectedCrops]="selCropForm.get('cropSelection').get('cropEppoCode').value"
                            [dssSelection]="dssSel" (select)="onSelectDSS($event)" (deselect)="onDeselectDSS($event)">
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </accordion-group>
                </accordion>-->
              </div>
            </fieldset>
          </div>
        </div>
      </form>
    </fieldset>
    <div class="row pt-3">
      <div class="col-md-12">
        <button class="btn btn-primary col-4 pull-right ml-1" (click)="onSave()"
          [disabled]="!selectedDss || selectedDss.length ==0">
          <i class="fas fa-save"></i>&nbsp;
          {{ 'Common_labels.Save' | translate }}
        </button>
        <button class="btn btn-info col-4 pull-right" type="button" (click)="goBack()">
          {{ 'Common_labels.Cancel' | translate }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- COUNTRY FILTER INFO MODAL -->
<ng-template #countryFilterInfoModal>
  <div class="modal-header">
    <h4 class="modal-title pull-left">
      <span class="modalInfoIcon fa-stack">
          <i class="fas fa-circle fa-stack-1x"></i>
          <i class="fas fa-info-circle fa-stack-1x"></i>
        </span> <b>{{ 'DSS_model_selection.Country_filter_info_title' | translate }}</b>
    </h4>
    <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
      <div class="form-group row">
          <div class="col-sm-9">
            <p>{{ 'DSS_model_selection.Country_filter_info_description' | translate }}</p>
          </div>
      </div>
  </div>
  <div class="modal-footer pull-right">
    <button type="button" class="btn btn-info push-right" (click)="modalRef.hide()">{{ 'Common_labels.Close' | translate }}</button>
  </div>
</ng-template>