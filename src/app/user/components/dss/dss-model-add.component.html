<div class="app-main__inner">
  <div class="app-page-title">
    <div class="page-title-wrapper">
      <div class="page-title-heading">
        <div class="page-title-icon">
          <i class="pe-7s-note icon-gradient bg-mean-fruit">
          </i>
        </div>
        <div>DSS Model Selection</div>
      </div>
    </div>
  </div>
  <div class="container mx-auto my-5 page-box">
    <fieldset class="border p-2">
      <legend class="w-auto px-1 text-muted h3">
        <strong class="bold-600">
          {{ farm.name }}
        </strong>
      </legend>
      <form [formGroup]="selCropForm">
        <div class="row">
          <div class="col-6">
            <fieldset class="border p-3 m-3">
              <legend class="w-auto px-1 text-muted h5">
                <b>Crops selection</b>
              </legend>

              <div formGroupName="cropSelection">
                <div class="form-group row">
                 <!-- <div class="col-sm-1 align-self-center text-muted h6">
                    <label for="crops">
                      <b>Crops</b>
                    </label>
                  </div>-->
                  <div class="col-sm-11">
                    <select multiple class="form-control" id="crops" formControlName="cropEppoCode">
                      <ng-template ngFor let-crop [ngForOf]="cropsEppoCodes">
                        <option value="{{crop.code}}">{{ crop.code | eppoCode }} ({{ crop.code }})</option>
                      </ng-template>
                    </select>
                    <span>
                      <small class="col-2 pull-left mt-2">Use <b>CTRL</b> + <b>Click</b> to select multiple crops</small>
                      <button class="btn btn-info btn-sm pull-right mt-2 col-3" (click)="onConfirmSelectedCrops()"
                      [disabled]="!selCropForm.get('cropSelection').get('cropEppoCode').valid">
                      Show DSS
                    </button>
                    </span>
                  </div>
                  <!--<div class="col-sm-2 align-self-center">
                    <button class="btn btn-info btn-sm" (click)="onConfirmSelectedCrops()"
                      [disabled]="!selCropForm.get('cropSelection').get('cropEppoCode').valid">
                      Show DSS
                    </button>
                  </div>-->
                </div>
              </div>
            </fieldset>
          </div>

          <div *ngIf="areCropsSelected" class="col-12 mt-4">
            <fieldset class="border p-3 ml-3 mr-3 mb-3">
              <legend class="w-auto px-1 text-muted h5">
                <b>DSS models selection</b>
              </legend>
              <div class="row">
                <accordion class="col" [isAnimated]="true">
                  <accordion-group *ngFor="let dssSel of data">
                    <span accordion-heading tooltip="Click to show">
                      {{dssSel.name}}
                      <i class="fas fa-bars" style="position:absolute; top: 40%; right: 2%;"></i>
                    </span>
                    <div class="col">
                      <table class="table table-striped table-bordered">
                        <thead>
                          <tr>
                            <th class="text-center col-3">CROP NAME</th>
                            <th class="text-center col-3">PEST NAME</th>
                            <th class="text-center">DSS NAME</th>
                            <th class="text-center"></th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr app-dss-model-row *ngFor="let model of dssSel.models; index as i" [model]="model"
                            [selectedCrops]="selCropForm.get('cropSelection').get('cropEppoCode').value"
                            [dssSelection]="dssSel" (select)="onSelectDSS($event)" (deselect)="onDeselectDSS($event)">
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </accordion-group>
                </accordion>
              </div>
            </fieldset>
          </div>
        </div>
      </form>
    </fieldset>
    <div class="row pt-3">
      <div class="col-md-12">
        <button class="btn btn-primary col-2 pull-right ml-1" (click)="onSave()"
          [disabled]="!selectedDss || selectedDss.length ==0">
          Save
        </button>
        <button class="btn btn-info col-2 pull-right" type="button" (click)="goBack()">
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>